# ===========================
# 🧮 Estimación de tamaño muestral e IC
# Versión Gretl 2025b - Parámetros calibrados
# ===========================

# === Parámetros poblacionales y de diseño ===
scalar sigma  = 100        # Desvío estándar poblacional
scalar sigma2 = sigma^2
scalar E      = 15         # Error máximo aceptable
scalar Z      = 1.96       # Valor z (95% de confianza)
scalar N      = 500        # Tamaño de población finita
scalar media  = 20         # Nueva media poblacional esperada

# === Método A ===
scalar n_A1 = (Z^2 * sigma2) / E^2
scalar n_A  = n_A1 / (1 + (n_A1 / N))

# === Método B ===
scalar n_B = (N * Z^2 * sigma2) / (N * E^2 + Z^2 * sigma2)

# === Método C ===
scalar n_C = sigma2 / ((E / Z)^2 + (sigma2 / N))

# === Método D: módulo redondeado ===
scalar n0 = (Z^2 * sigma2) / E^2
scalar n_D = n0 / (1 + n0 / N)
scalar n_redondeado = ceil(n_D)

# === Comparación de tamaños muestrales ===
printf "\n🚀 ==== Tamaños muestrales estimados ====\n"
printf "📊 Método A: %.3f\n", n_A
printf "📊 Método B: %.3f\n", n_B
printf "📊 Método C: %.3f\n", n_C
printf "📊 Método D (redondeado): %d\n", n_redondeado

# === Intervalo de confianza corregido ===
scalar f      = n_redondeado / N
scalar margen = Z * sigma / sqrt(n_redondeado) * sqrt(1 - f)
scalar inf    = media - margen
scalar sup    = media + margen

# === Resultados del intervalo de confianza ===
printf "\n📐 Intervalo de confianza al 95%% (n = %d):\n", n_redondeado
printf "Media esperada: %.2f\n", media
printf "Margen de error corregido: %.2f\n", margen
printf "Límite inferior: %.2f\n", inf
printf "Límite superior: %.2f\n", sup
